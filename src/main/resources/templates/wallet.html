<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debt Wallet</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">

</head>
<body>
<div class="app-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="mb-0"><i class="fas fa-wallet me-2"></i>Debt Wallet</h1>
        </div>
    </div>
</div>

<div class="container" id="app"></div>

<!-- Modals -->
<div class="modal fade" id="walletModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Wallet</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="walletForm">
                    <div class="mb-3">
                        <label class="form-label">Wallet Name</label>
                        <input type="text" class="form-control" id="walletName" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="app.createWallet()">Create Wallet</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="debtModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Debt</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="debtForm">
                    <div class="mb-3">
                        <label class="form-label">Client Name</label>
                        <input type="text" class="form-control" id="debtName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="debtDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="debtEmail">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Amount Owed ($)</label>
                        <input type="number" step="0.01" class="form-control" id="debtValue" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Payment Type</label>
                        <select class="form-select" id="debtPaymentType">
                            <option value="one-time">One-time</option>
                            <option value="recurring">Recurring</option>
                            <option value="installment">Installment</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="app.createDebt()">Create Debt</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="paymentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Record Payment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="paymentForm">
                    <div class="mb-3">
                        <label class="form-label">Payment Amount ($)</label>
                        <input type="number" step="0.01" class="form-control" id="paymentAmount" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Payment Date</label>
                        <input type="date" class="form-control" id="paymentDate" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Payment Type</label>
                        <select class="form-select" id="paymentType">
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                            <option value="bank-transfer">Bank Transfer</option>
                            <option value="credit-card">Credit Card</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="app.recordPayment()">Record Payment</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>
    // Data Models
    class Wallet {
      constructor(name) {
        this.id = this.generateId();
        this.name = name;
        this.debts = [];
        this.createdAt = new Date().toISOString();
      }

      generateId() {
        return 'wallet_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }

      getTotalOwed() {
        return this.debts.reduce((sum, debt) => sum + debt.getOutstanding(), 0);
      }
    }

    class Debt {
      constructor(walletId, name, description, email, value, paymentType) {
        this.id = this.generateId();
        this.walletId = walletId;
        this.name = name;
        this.description = description;
        this.email = email;
        this.value = parseFloat(value);
        this.paymentType = paymentType;
        this.payments = [];
        this.createdAt = new Date().toISOString();
      }

      generateId() {
        return 'debt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }

      getTotalPaid() {
        return this.payments.reduce((sum, payment) => sum + payment.amount, 0);
      }

      getOutstanding() {
        return Math.max(0, this.value - this.getTotalPaid());
      }

      isFullyPaid() {
        return this.getOutstanding() === 0;
      }
    }

    class Payment {
      constructor(debtId, amount, date, type) {
        this.id = this.generateId();
        this.debtId = debtId;
        this.amount = parseFloat(amount);
        this.date = date;
        this.type = type;
        this.createdAt = new Date().toISOString();
      }

      generateId() {
        return 'payment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      }
    }

    // Application State Manager
    class DebtWalletApp {
      constructor() {
        this.wallets = [];
        this.currentView = 'dashboard';
        this.currentWallet = null;
        this.currentDebt = null;
        this.loadData();
        this.render();
      }

      // Data Persistence
      saveData() {
        localStorage.setItem('debtWalletData', JSON.stringify(this.wallets));
      }

      loadData() {
        const data = localStorage.getItem('debtWalletData');
        if (data) {
          const parsed = JSON.parse(data);
          this.wallets = parsed.map(w => Object.assign(new Wallet(), w));
          this.wallets.forEach(wallet => {
            wallet.debts = wallet.debts.map(d => Object.assign(new Debt(), d));
            wallet.debts.forEach(debt => {
              debt.payments = debt.payments.map(p => Object.assign(new Payment(), p));
            });
          });
        } else {
          // Initialize with sample data
          this.initializeSampleData();
        }
      }

      initializeSampleData() {
        const wallet1 = new Wallet('Freelance Clients');
        const debt1 = new Debt(wallet1.id, 'Acme Corp', 'Website redesign project', 'contact@acme.com', 5000, 'one-time');
        const payment1 = new Payment(debt1.id, 2000, '2024-11-15', 'bank-transfer');
        debt1.payments.push(payment1);
        wallet1.debts.push(debt1);

        const debt2 = new Debt(wallet1.id, 'Tech Startup', 'Mobile app development', 'ceo@startup.com', 8000, 'installment');
        wallet1.debts.push(debt2);

        this.wallets.push(wallet1);

        const wallet2 = new Wallet('Consulting Projects');
        const debt3 = new Debt(wallet2.id, 'Local Business', 'Marketing consultation', 'owner@localbiz.com', 1500, 'recurring');
        wallet2.debts.push(debt3);

        this.wallets.push(wallet2);
        this.saveData();
      }

      // Navigation
      showDashboard() {
        this.currentView = 'dashboard';
        this.currentWallet = null;
        this.currentDebt = null;
        this.render();
      }

      showWallet(walletId) {
        this.currentWallet = this.wallets.find(w => w.id === walletId);
        this.currentView = 'wallet';
        this.currentDebt = null;
        this.render();
      }

      showDebt(debtId) {
        const debt = this.currentWallet.debts.find(d => d.id === debtId);
        this.currentDebt = debt;
        this.currentView = 'debt';
        this.render();
      }

      // CRUD Operations
      createWallet() {
        const name = document.getElementById('walletName').value;
        if (!name) return;

        const wallet = new Wallet(name);
        this.wallets.push(wallet);
        this.saveData();

        bootstrap.Modal.getInstance(document.getElementById('walletModal')).hide();
        document.getElementById('walletForm').reset();
        this.render();
      }

      createDebt() {
        const name = document.getElementById('debtName').value;
        const description = document.getElementById('debtDescription').value;
        const email = document.getElementById('debtEmail').value;
        const value = document.getElementById('debtValue').value;
        const paymentType = document.getElementById('debtPaymentType').value;

        if (!name || !value) return;

        const debt = new Debt(this.currentWallet.id, name, description, email, value, paymentType);
        this.currentWallet.debts.push(debt);
        this.saveData();

        bootstrap.Modal.getInstance(document.getElementById('debtModal')).hide();
        document.getElementById('debtForm').reset();
        this.render();
      }

      recordPayment() {
        const amount = document.getElementById('paymentAmount').value;
        const date = document.getElementById('paymentDate').value;
        const type = document.getElementById('paymentType').value;

        if (!amount || !date) return;

        // Simulate API call
        console.log('Sending payment to backend:', { debtId: this.currentDebt.id, amount, date, type });

        const payment = new Payment(this.currentDebt.id, amount, date, type);
        this.currentDebt.payments.push(payment);
        this.saveData();

        bootstrap.Modal.getInstance(document.getElementById('paymentModal')).hide();
        document.getElementById('paymentForm').reset();
        this.render();
      }

      // Rendering
      render() {
        const app = document.getElementById('app');

        switch(this.currentView) {
          case 'dashboard':
            app.innerHTML = this.renderDashboard();
            break;
          case 'wallet':
            app.innerHTML = this.renderWallet();
            break;
          case 'debt':
            app.innerHTML = this.renderDebt();
            break;
        }
      }

      renderDashboard() {
        const totalOwed = this.wallets.reduce((sum, w) => sum + w.getTotalOwed(), 0);

        return `
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="stat-card">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <p class="text-muted mb-1">Total Amount Owed</p>
                    <h2 class="mb-0">$${totalOwed.toFixed(2)}</h2>
                  </div>
                  <div class="text-primary" style="font-size: 3rem; opacity: 0.2;">
                    <i class="fas fa-dollar-sign"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="stat-card">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <p class="text-muted mb-1">Active Wallets</p>
                    <h2 class="mb-0">${this.wallets.length}</h2>
                  </div>
                  <div class="text-primary" style="font-size: 3rem; opacity: 0.2;">
                    <i class="fas fa-wallet"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>My Wallets</h3>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#walletModal">
              <i class="fas fa-plus me-2"></i>New Wallet
            </button>
          </div>

          ${this.wallets.length === 0 ? `
            <div class="empty-state">
              <i class="fas fa-wallet"></i>
              <h4>No wallets yet</h4>
              <p>Create your first wallet to start tracking debts</p>
            </div>
          ` : this.wallets.map(wallet => `
            <div class="wallet-card" onclick="app.showWallet('${wallet.id}')">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="mb-1">${wallet.name}</h5>
                  <small class="text-muted">${wallet.debts.length} debt(s)</small>
                </div>
                <div class="text-end">
                  <h4 class="mb-0 text-primary">$${wallet.getTotalOwed().toFixed(2)}</h4>
                  <small class="text-muted">owed</small>
                </div>
              </div>
            </div>
          `).join('')}
        `;
      }

      renderWallet() {
        const wallet = this.currentWallet;

        return `
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#" onclick="app.showDashboard(); return false;">Dashboard</a></li>
              <li class="breadcrumb-item active">${wallet.name}</li>
            </ol>
          </nav>

          <div class="row mb-4">
            <div class="col-md-12">
              <div class="stat-card">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h4 class="mb-1">${wallet.name}</h4>
                    <p class="text-muted mb-0">${wallet.debts.length} debt(s)</p>
                  </div>
                  <div class="text-end">
                    <h2 class="mb-0 text-primary">$${wallet.getTotalOwed().toFixed(2)}</h2>
                    <small class="text-muted">total owed</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3>Debts</h3>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#debtModal">
              <i class="fas fa-plus me-2"></i>New Debt
            </button>
          </div>

          ${wallet.debts.length === 0 ? `
            <div class="empty-state">
              <i class="fas fa-file-invoice-dollar"></i>
              <h4>No debts in this wallet</h4>
              <p>Add your first debt to start tracking</p>
            </div>
          ` : wallet.debts.map(debt => `
            <div class="debt-card ${debt.isFullyPaid() ? 'fully-paid' : ''}" onclick="app.showDebt('${debt.id}')">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h5 class="mb-1">
                    ${debt.name}
                    ${debt.isFullyPaid() ? '<span class="badge bg-success ms-2">Paid</span>' : ''}
                  </h5>
                  <p class="text-muted mb-2">${debt.description || 'No description'}</p>
                  <div class="d-flex gap-3">
                    <small class="text-muted">
                      <i class="fas fa-envelope me-1"></i>${debt.email || 'No email'}
                    </small>
                    <small class="text-muted">
                      <i class="fas fa-credit-card me-1"></i>${debt.paymentType}
                    </small>
                  </div>
                </div>
                <div class="text-end">
                  <h5 class="mb-1 ${debt.isFullyPaid() ? 'text-success' : 'text-danger'}">
                    $${debt.getOutstanding().toFixed(2)}
                  </h5>
                  <small class="text-muted">of $${debt.value.toFixed(2)}</small>
                  <div class="mt-2">
                    <div class="progress" style="height: 6px; width: 100px;">
                      <div class="progress-bar bg-success" style="width: ${(debt.getTotalPaid() / debt.value * 100).toFixed(0)}%"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `).join('')}
        `;
      }

      renderDebt() {
        const debt = this.currentDebt;

        return `
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#" onclick="app.showDashboard(); return false;">Dashboard</a></li>
              <li class="breadcrumb-item"><a href="#" onclick="app.showWallet('${this.currentWallet.id}'); return false;">${this.currentWallet.name}</a></li>
              <li class="breadcrumb-item active">${debt.name}</li>
            </ol>
          </nav>

          <div class="row mb-4">
            <div class="col-md-12">
              <div class="stat-card">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <div class="flex-grow-1">
                    <h3 class="mb-2">
                      ${debt.name}
                      ${debt.isFullyPaid() ? '<span class="badge bg-success ms-2">Fully Paid</span>' : '<span class="badge bg-warning text-dark ms-2">Outstanding</span>'}
                    </h3>
                    <p class="text-muted mb-3">${debt.description || 'No description'}</p>
                    <div class="row">
                      <div class="col-md-4 mb-2">
                        <small class="text-muted d-block">Email</small>
                        <strong>${debt.email || 'Not provided'}</strong>
                      </div>
                      <div class="col-md-4 mb-2">
                        <small class="text-muted d-block">Payment Type</small>
                        <strong>${debt.paymentType}</strong>
                      </div>
                      <div class="col-md-4 mb-2">
                        <small class="text-muted d-block">Created</small>
                        <strong>${new Date(debt.createdAt).toLocaleDateString()}</strong>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row text-center">
                  <div class="col-md-4">
                    <p class="text-muted mb-1">Total Amount</p>
                    <h4 class="mb-0">$${debt.value.toFixed(2)}</h4>
                  </div>
                  <div class="col-md-4">
                    <p class="text-muted mb-1">Paid</p>
                    <h4 class="mb-0 text-success">$${debt.getTotalPaid().toFixed(2)}</h4>
                  </div>
                  <div class="col-md-4">
                    <p class="text-muted mb-1">Outstanding</p>
                    <h4 class="mb-0 text-danger">$${debt.getOutstanding().toFixed(2)}</h4>
                  </div>
                </div>

                <div class="progress mt-3" style="height: 10px;">
                  <div class="progress-bar bg-success" style="width: ${(debt.getTotalPaid() / debt.value * 100).toFixed(0)}%"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Payment History</h4>
            ${!debt.isFullyPaid() ? `
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#paymentModal" onclick="document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0]">
                <i class="fas fa-plus me-2"></i>Record Payment
              </button>
            ` : ''}
          </div>

          ${debt.payments.length === 0 ? `
            <div class="empty-state">
              <i class="fas fa-money-bill-wave"></i>
              <h4>No payments yet</h4>
              <p>Record the first payment to start tracking</p>
            </div>
          ` : debt.payments.sort((a, b) => new Date(b.date) - new Date(a.date)).map(payment => `
            <div class="payment-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">$${payment.amount.toFixed(2)}</h6>
                  <small class="text-muted">
                    <i class="fas fa-calendar me-1"></i>${new Date(payment.date).toLocaleDateString()}
                    <i class="fas fa-credit-card ms-3 me-1"></i>${payment.type}
                  </small>
                </div>
                <div>
                  <i class="fas fa-check-circle text-success" style="font-size: 1.5rem;"></i>
                </div>
              </div>
            </div>
          `).join('')}
        `;
      }
    }

    // Initialize the application
    const app = new DebtWalletApp();
</script>
</body>
</html>
